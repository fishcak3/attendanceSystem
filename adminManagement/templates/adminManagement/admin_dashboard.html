<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/adminStyle.css' %}">
    <script src="{% static 'js/dashboard.js' %}" defer></script>
</head>
<body>

    <h1>Welcome to the Admin Dashboard</h1>

    <!-- admin_dashboard.html -->
    {% if user.is_authenticated %}
        <p>Welcome, {{ user.username }}!</p>
    {% endif %}

    <!-- Sidebar Navigation -->
    <nav class="fixed-nav">
        <button onclick="showSection('students-section')">Students</button>
        <button onclick="showSection('events-section')">Events</button>
        <button onclick="showSection('history-section')">History</button>
        
        <div class="spacer"></div> <!-- This div creates space above the logout button -->
        
        <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="logout-button">Logout</button>
        </form>
    </nav>



    <!-- Main Content -->
    <div class="content">
        <!-- Students Section -->
        <div id="students-section" class="section">
            <h2>Students</h2>
            <a href="{% url 'add_student' %}">
                <button class="create">Add Student</button>
            </a>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Student ID</th>
                        <th>Image</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td>{{ student.name }}</td>
                        <td>{{ student.student_id }}</td>
                        <td>
                            {% if student.image %}
                                <img src="{{ student.image.url }}" alt="Student Image" width="50">
                            {% else %}
                                No image
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'edit_student' student.id %}">
                                <button class="edit">Edit</button>
                            </a>
                            <form method="POST" action="{% url 'delete_student' student.id %}" onsubmit="return confirm('Are you sure you want to delete this student?');" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="delete">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Events Section -->
        <div id="events-section" class="section">
            <h2>Current Events</h2>
            <a href="{% url 'create_event' %}">
                <button class="create">Create Event</button>
            </a>
            <table id="manage-event-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Location</th>
                        <th>Finish</th>
                        <th>View Attendees</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in events %}
                    <tr>
                        <td>{{ event.event_name }}</td>
                        <td>{{ event.event_date }}</td>
                        <td>{{ event.event_time }}</td>
                        <td>{{ event.location_description }}</td>
                        <td>
                            <form method="POST" action="{% url 'mark_event_as_finished' event.id %}" onsubmit="return confirmMarkEvent();">
                                {% csrf_token %}
                                <button type="submit">Finish</button>
                            </form>
                        </td>
                        <td>
                            <a href="{% url 'view_attendees' event.id %}">
                                <button>View Attendees</button>
                            </a>
                        </td>
                        <td>
                            <a href="{% url 'edit_event' event.id %}">
                                <button class="edit">Edit</button>
                            </a>
                            <form method="POST" action="{% url 'delete_event' event.id %}" onsubmit="return confirm('Are you sure you want to delete this event?');" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="delete">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if not events %}
                    <tr>
                        <td colspan="7">No events available.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- History Section -->
        <div id="history-section" class="section" style="display: none;">
            <h2>Finished Events</h2>
            <table id="finished-events-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Total Attendees</th>
                        <th>Attendees</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for finished_event in finished_events %}
                    <tr>
                        <td>{{ finished_event.event_name }}</td>
                        <td>{{ finished_event.event_date }}</td>
                        <td>{{ finished_event.students_checked_in.count }}</td> <!-- Ensure this is correct -->
                        <td>
                            <a href="{% url 'view_finished_attendees' finished_event.id %}">
                                <button>View Attendees</button>
                            </a>
                        </td>
                        <td>
                            <a href="{% url 'download_event_excel' finished_event.id %}">
                                <button>Download Event Data</button>
                            </a>
                            <form method="POST" action="{% url 'delete_finished_event' finished_event.id %}" onsubmit="return confirm('Are you sure you want to delete this finished event?');">
                                {% csrf_token %}
                                <button type="submit" class="delete">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if not finished_events %}
                    <tr>
                        <td colspan="5">No finished events available.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

    </div> <!-- End of Content -->

</body>
</html>
